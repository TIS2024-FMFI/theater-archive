{% extends 'archive_app/index.html' %}
{% load static %}
{% block content %}
<section class="content">
    <link rel="stylesheet" href="{%  static 'archive_app/form_concerts_and_events.css' %}">
    <script>
        let timeout = null;
        async function fetchSuggestions(id) {
            clearTimeout(timeout)
            timeout = setTimeout(async () => {
                let query = document.getElementById(id).value.trim();
                let suggestionsBox = document.getElementById(id+"_suggestions");

                if (!query) {
                    suggestionsBox.innerHTML = "";
                    return;
                }

                const response = await fetch(`/autocomplete/?query=${encodeURIComponent(query)}`, {
                    headers: {"X-Requested-With": "XMLHttpRequest"}
                });

                if (!response.ok) {
                    suggestionsBox.innerHTML = "";
                    return;
                }

                const data = await response.json();

                suggestionsBox.innerHTML = "";

                data.forEach(item => {
                    let option = document.createElement("option");
                    option.value = item;
                    suggestionsBox.appendChild(option);
                });
            }, 200)
        }

        window.onload = function (){
            document.getElementById('genre_type').addEventListener('change', function () {
                if(this.value == '-'){
                    document.getElementById('staging_team').innerHTML = '';
                    return;
                }
                let genreName = this.options[this.selectedIndex].text;
                let contentDiv = document.getElementById('staging_team');
                fetch(`/genre_staging_team/${genreName}/`,{
                    method: "GET",
                    headers: {"X-Requested-With": "XMLHttpRequest"}
                })
                    .then(response => response.text())
                    .then(html => {
                        contentDiv.innerHTML = html;
                    })
                    .catch(error => console.error('Error loading genre content:', error));
            });
        }
    </script>
    <div class="form-container">

        <h2>{% if play.id %}Upraviť{% else %}Pridať{% endif %} divadelné predstavenie</h2>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="form-group">
                <label for="title">Titul:</label>
                <input id="title" name="title" type="text" placeholder="Titul" required {% if play.id %} value="{{ form.title.value }}" {% endif %}>
{#                <label for="subtitle">Podtitul:</label>#}
                <input type="text" id="subtitle" placeholder="Podtitul" {% if play.subtitle %} value="{{ form.subtitle.value }}" {% endif %}>
            </div>

            <div class="form-group">
                <label for="author-name">Autor:</label>
                <input type="text" name="author_first_name" placeholder="Meno" {% if play.id %} value="{{ form.author_first_name.value }}" {% endif %}>
                <input type="text" name="author_last_name" placeholder="Priezvisko" {% if play.id %} value="{{ form.author_last_name.value }}" {% endif %}>
            </div>

            <div class="form-group">
                <label for="ensemble">Súbor:</label>
                <select id="ensemble" name="ensemble" required>
                    {% for e in ensembles %}
                        <option value="{{ e.id }}" {% if play.ensembles == e %}selected{% endif %}> {{ e.name }}  </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="description">Popis:</label>
                <textarea id="description" name="description" rows="5" placeholder="Sem píšte popis...">{% if play.id %}{{ form.description.value }}{% endif %}</textarea>
            </div>

            <div class="form-group">
                <label for="genre">Žáner:</label>
                <select id="genre_type" name="genre_type">
                <option value="-" selected>-</option>
                    {% for g in genres %}
                        <option value="{{ g.id }}" {% if play.genre_type == g %}selected{% endif %}> {{ g.name }}  </option>
                    {% endfor %}
                </select>
            </div>

            <div id="staging_team"></div>

            <h3> Prílohy:</h3>
            <div class="form-group upload-section">
                 <label class="upload-label">Články a kritiky&ensp;
                    <input type="file" id="file-upload-1" class="file-input" accept="image/*, .pdf, .doc, .docx">
                    <span class="btn">Prilož súbor</span>
                    <img id="file-preview-1" class="file-preview">
                </label>

                <label class="upload-label">Plagát a bulletin&ensp;
                    <input type="file" id="file-upload-2" class="file-input" accept="image/*, .pdf, .doc, .docx">
                    <span class="btn">Prilož súbor</span>
                    <img id="file-preview-2" class="file-preview">
                </label>

                <label class="upload-label">Fotografie&ensp;
                    <input type="file" id="file-upload-3" class="file-input" accept="image/*, .pdf, .doc, .docx">
                    <span class="btn">Prilož súbor</span>
                    <img id="file-preview-3" class="file-preview">
                </label>
            </div>


            <div class="form-actions">
                <label for="publish" class="publish">
                    <input type="checkbox" name="publicity" {% if play.publicity == True %} checked {% endif %}> Zverejniť
                </label>
                <button type="submit" class="submit">Uložiť</button>
            </div>
        </form>
    </div>

</section>
{% endblock %}