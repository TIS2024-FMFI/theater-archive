{% extends 'archive_app/index.html' %}
{% load static %}
{% block content %}
<section class="content">
    <link rel="stylesheet" href="{% static 'archive_app/form_concerts_and_events.css' %}">
    <div class="form-container">
        <h2>Pridanie umelca</h2>
        <form>

            <!-- First Row: Meno & Priezvisko -->
            <div class="form-row">
                <div class="form-group">
                    <label for="artist-name">Meno:</label>
                    <input type="text" id="artist-name" placeholder="meno umelca">
                </div>
                <div class="form-group">
                    <label for="artist-surname">Priezvisko:</label>
                    <input type="text" id="artist-surname" placeholder="priezvisko umelca">
                </div>
            </div>

            <!-- Host / umelec SND -->
            <div class="form-group">
                <label for="snd-artist">Host/umelec SND:</label>
                <select id="snd-artist" name="employee_type" >
                    <option value="-">-</option>
                    {% for etype in employee_form.employee_type.field.queryset %}
                        <option value="{{ etype.id }}">{{ etype.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <hr style="height: 0px; border: none; border-top: 1px solid #ccc; ">


{#            <!-- Dátumy Zamestnania -->#}
{#            <div class="form-group">#}
{#                <label for="start-date">Dátumy zamestnania:</label>#}
{#                <div class="form-row">#}
{#                    <div class="form-group">#}
{#                        <label for="start-date">Začiatok:</label>#}
{#                        <input type="date" id="start-date" value="2024-11-17">#}
{#                    </div>#}
{#                    <div class="form-group">#}
{#                        <label for="end-date">Koniec:</label>#}
{#                        <input type="date" id="end-date" value="2024-11-17">#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}

            <!-- Zaradenie & Odbor -->
            <div class="form-group" id="jobContainer">
                <label for="category">Zaradenie/odbor:</label>
                {{ job_formset.management_form }}
                {% for form in job_formset %}
                <div class="form-row">

                    <div class="form-row" id="job_entry">
                        <div class="form-group">
                            <select id="category" name="{{ form.job.name }}">
                                <option value="">Iné zamestnanie</option>
                                {% for job in form.fields.job.queryset %}
                                    <option value="{{ job.id }}" {% if form.job.value == job.id %}selected{% endif %}>
                                        {{ job.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="new-job-field form-group">
{#                            <label for="new-job">Or Enter a New Job</label>#}
                            <input type="text" class="form-control new-job-input" placeholder="Enter new job name">
                        </div>

                        <div class="form-group">
                            <label for="start-date">Začiatok:</label>
                            <input type="date" name="{{ form.date_start.name }}" value="{{ form.date_start.value|default:'' }}">
                        </div>
                        <div class="form-group">
                            <label for="end-date">Koniec:</label>
                            <input type="date" name="{{ form.date_end.name }}" value="{{ form.date_end.value|default:'' }}">
                        </div>
                        <div class="form-group">
                            <button type="button" class="remove-job btn">✖</button>
                        </div>
                        <hr style="height: 0px; border: none; border-top: 1px solid #ccc; ">
                        <button type="button" class="btn" id="add-job">&#10010;</button>

                    </div>

{#                    <div class="form-group">#}
{#                        <label></label>#}
{#                        #}
{#                    </div>#}
                </div>
                {% endfor %}
            </div>


            <hr>
            <!-- Zložka, Dátumy Narodenia a Úmrtia -->
            <div class="form-row">
                <div class="form-group">
                    <label for="folder">Zložka:</label>
                    <select id="folder">
                        {% for g in employee_form.genre_type.field.queryset %}
                            <option value="{{ g.id }}">{{ g.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="birth-date">Dátum narodenia:</label>
                    <input type="date" id="birth-date" value="1983-07-21">
                </div>
                <div class="form-group">
                    <label for="death-date">Dátum úmrtia:</label>
                    <input type="date" id="death-date">
                </div>
                <div class="form-group">
                    <label></label>
                    <label class="inline-checkbox">
                        <input type="checkbox" id="publish-dates"> zverejniť dátumy
                    </label>
                </div>
            </div>

           <hr style="height: 0px; border: none; border-top: 1px solid #ccc; ">
            <!-- Narodenie & Miesto úmrtia -->
            <div class="form-row">
                <div class="form-group">
                    <label for="birthplace">Narodený/á:</label>
                    <input type="text" id="birthplace" placeholder="miesto narodenia">
                </div>
                <div class="form-group">
                    <label for="deathplace">Miesto úmrtia:</label>
                    <input type="text" id="deathplace" placeholder="miesto úmrtia">
                </div>
            </div>

            <!-- Súbor Selection -->
            <div class="form-group">
                <label for="file">Súbor:</label>
                <select id="file">
                    <option value="opera_snd">Opera SND</option>
                </select>
            </div>

            <!-- Popis -->
            <div class="form-group">
                <label for="description">Popis:</label>
                <textarea id="description" rows="5"></textarea>
            </div>

            <h3> Prílohy:</h3>
            <div class="form-group upload-section">
                <label class="upload-label">Titulná fotogtafia&ensp;
                    <input type="file" id="file-upload-profile" class="file-input" accept="image/*, .pdf, .doc, .docx">
                    <span class="btn">Prilož súbor</span>
                    <img id="file-preview-profile" class="file-preview">
                </label>
                <br>
                <label class="upload-label">Ďalšie fotografie&ensp;
                    <input type="file" id="file-upload-other" class="file-input" accept="image/*, .pdf, .doc, .docx">
                    <span class="btn">Prilož súbor</span>
                    <img id="file-preview-other" class="file-preview">
                </label>
            </div>

            <div class="form-actions">
                <label for="publish" class="publish">
                    <input type="checkbox" id="publish">Zverejniť
                </label>
                <button type="submit" class="submit">Uložiť</button>
            </div>
        </form>
    </div>
</section>

    <script>
         function toggleNewJobField() {
            var selectField = document.getElementById("category");
            var newJobField = document.querySelector(".new-job-field");

            if (selectField.value === "") {
                newJobField.style.display = "block";  // Show input if "Vyberte prácu" is selected
            } else {
                newJobField.style.display = "none";  // Hide otherwise
            }
        }

        document.querySelectorAll('.file-input').forEach((input) => {
            input.addEventListener('change', function () {
                let file = this.files[0];
                let previewElement = document.getElementById('file-preview-' + this.id.split('-')[2]);

                if (file) {
                    // Check if the file is an image
                    if (file.type.startsWith('image/')) {
                        let reader = new FileReader();
                        reader.onload = function (e) {
                            previewElement.src = e.target.result;
                            previewElement.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        previewElement.style.display = 'none';
                    }

                    this.nextElementSibling.textContent = "Súbor prijatý";
                }
            });
        });

         document.getElementById("category").addEventListener("change", toggleNewJobField);

        document.addEventListener("DOMContentLoaded", function () {
            {#toggleNewJobField();#}
            let jobContainer = document.getElementById("jobContainer");
            let addButton = document.getElementById("add-job");
            let totalForms = document.querySelector("#id_employeejob_set-TOTAL_FORMS");

            if (addButton) {
                addButton.addEventListener("click", function () {
                    let formCount = parseInt(totalForms.value);
                    let template = document.getElementById("job_entry");

                    if (!template) {
                        console.error("Error: 'job_entry' element not found.");
                        return;
                    }

                    let newEntry = template.cloneNode(true);
                    newEntry.removeAttribute("id"); // Remove duplicate ID

                    // Remove the "Add Job" button from the cloned entry
                    let clonedAddButton = newEntry.querySelector("#add-job");
                    if (clonedAddButton) {
                        clonedAddButton.style.visibility = "hidden";
                    }

                    // Update form field names for Django formset
                    newEntry.innerHTML = newEntry.innerHTML.replace(/-\d+-/g, `-${formCount}-`);

                    // Fix: Ensure the new select field correctly toggles the input field
                    let selectField = newEntry.querySelector("select");
                    let newJobField = newEntry.querySelector(".new-job-field");

                    console.log("Cloned Select Field:", selectField); // Debugging line
                    console.log("Cloned New Job Field:", newJobField); // Debugging line

                    if (selectField && newJobField) {
                        selectField.addEventListener("change", function () {
                            if (this.value === "" || this.value === "-") {
                                console.log("show");
                                newJobField.style.display = "block";
                            } else {
                                newJobField.style.display = "none";
                            }
                        });

                        // Ensure it is hidden initially
                        newJobField.style.display = "none";
                    }

                    // Clear input values
                    newEntry.querySelectorAll("input, select").forEach(input => {
                        if (input.type === "date") {
                            input.value = "";
                        } else if (input.tagName === "SELECT") {
                            input.selectedIndex = 0;
                        }
                    });

                    let removeButton = newEntry.querySelector(".remove-job, #remove-job");
                    if (removeButton) {
                        removeButton.addEventListener("click", function () {
                           this.parentElement.parentElement.remove(); // Remove the entire job entry
                            totalForms.value = document.querySelectorAll("#jobContainer > div").length;
                        });
                    } else {
                        console.error("Error: 'remove-job' button not found inside new entry.");
                    }

                    // Append the new job entry inside the job container
                    jobContainer.appendChild(newEntry);
                    totalForms.value = formCount + 1;
                });
            } else {
                console.error("Error: 'add-job' button not found.");
            }

            // Enable removing existing jobs
            //{#document.querySelectorAll(".remove-job, #remove-job").forEach(button => {#}
            //{#    button.addEventListener("click", function () {#}
            //{#        this.parentElement.parentElement.remove();#}
            //{#        totalForms.value = document.querySelectorAll("#jobContainer > div").length;#}
            //{#    });#}
            //});

            //     document.addEventListener("DOMContentLoaded", function () {
            //         document.querySelectorAll(".remove-job, #remove-job").forEach(button => {
            //             button.addEventListener("click", function () {
            //                 this.parentElement.parentElement.remove();
            //                 const totalForms = document.querySelector("#id_form-TOTAL_FORMS");
            //                 totalForms.value = document.querySelectorAll("#jobContainer > div").length;
            //             });
            //         });
            //     });
            });

</script>

{% endblock %}
